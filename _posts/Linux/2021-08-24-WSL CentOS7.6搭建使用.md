---
layout: post
categories: Linux
title: WSL CentOS7.6搭建使用
meta: WSL CentOS7.6搭建使用
---
* content
{:toc}

## 正文

### 启用WSL

**方式1**

在 控制面板\所有控制面板项\程序和功能 中选择 启用或者关闭Windows功能

找到 适用于Linux的Windows子系统 并勾选，然后 确定 选择 立即重新启动

**方式2**

在开始菜单中点击Windows Powershell进入，或者在开始菜单中磁性贴中点击Windows Powershell进入。

输入Powershell命令，查看确认版本，是否满足WSL安装要求：
```
Get-ComputerInfo | Select WindowsProductName, WindowsVersion, WindowsInstallationType, OsServerLevel, OsVersion, OsHardwareAbstractionLayer
```

启用WSL：
```
Enable-WindowsOptionalFeature -Online -FeatureName Microsoft-Windows-Subsystem-Linux
```

输入y或直接回车，电脑立即重启。重启后即成功启用了WSL。

```
Windows PowerShell
版权所有 (C) Microsoft Corporation。保留所有权利。
尝试新的跨平台 PowerShell https://aka.ms/pscore6 

PS C:\Users\bai> Get-ComputerInfo | Select WindowsProductName, WindowsVersion, WindowsInstallationType, OsServerLevel, OsVersion, OsHardwareAbstractionLayer

WindowsProductName         : Windows 10 Pro
WindowsVersion             : 1903
WindowsInstallationType    : Client
OsServerLevel              :
OsVersion                  : 10.0.18362
OsHardwareAbstractionLayer : 10.0.18362.1

PS C:\Users\bai> Enable-WindowsOptionalFeature -Online -FeatureName Microsoft-Windows-Subsystem-Linux            
是否立即重启计算机以完成此操作?
[Y] Yes  [N] No  [?] 帮助 (默认值为“Y”):
```

### 安装CentOS

在 [https://github.com/wsldl-pg/CentWSL/tags](https://github.com/wsldl-pg/CentWSL/tags) 下载 Centos包。

解压后放到指定目录下。

在目标目录中看到2个文件：rootfs.tar.gz 和 CentOS.exe。我们需要运行CentOS.exe，以便解压其中的文件并注册到WSL。
右键点击CentOS.exe并以管理员身份运行。

等一段时间，系统将自动进行初始化，完成后会有提示成功的消息，此时可按任意键退出安装。
如果时间过长，可以点击回车试试。

返回目录，看到多出了2个文件夹：rootfs、temp。

右击运行CentOS.exe，即成功登录系统了。

运行CentOS.exe后，查看安装的CentOS版本号：
> rpm -q centos-release

或者：
> cat /etc/redhat-release

在 WSL 系统中可以直接访问 windows 磁盘文件，可将一些安装软件包放在 E:\WslSoftbox 目录下，将网站web程序放在 D:\www 目录中。
而在 WSL 系统中的访问路径分别是 /mnt/e/WslSoftbox 和 /mnt/d/www 。当然 WSL 这样直接访问 windows 磁盘会有很大的性能问题。
后续使用中如果性能的降低超过了可忍受的程度，可以考虑将这两个目录移动到 WSL 的虚拟磁盘。

打开 Windows 安全中心 > 病毒和威胁防护设置 > 管理设置 > 添加或删除排除项 > 添加排除项，将上述两个目录排除，
这样会减少 windows 的系统性能占用。

### 卸载CentOS

不想用了，在WSL上卸载CentOS，用 Windows Powershell 切换到安装目录，执行：
> ./CentOS.exe clean

### 安装Nginx

我们可以编译安装，也可以选择yum方式安装。

**yum方式安装**

安装yum-utils，管理repository及扩展包的工具，细节参考下面资料。
> sudo yum install yum-utils

设置nginx的yum仓库配置：
> sudo vi /etc/yum.repos.d/nginx.repo

写入：
```
[nginx-stable]
name=nginx stable repo
baseurl=http://nginx.org/packages/centos/$releasever/$basearch/
gpgcheck=1
enabled=1
gpgkey=https://nginx.org/keys/nginx_signing.key
module_hotfixes=true

[nginx-mainline]
name=nginx mainline repo
baseurl=http://nginx.org/packages/mainline/centos/$releasever/$basearch/
gpgcheck=1
enabled=0
gpgkey=https://nginx.org/keys/nginx_signing.key
module_hotfixes=true
```

执行：
> sudo yum install nginx

安装完成。

查看版本：
```
[root@HIGDQEEMO63U9NR ~]# nginx -v
nginx version: nginx/1.20.1
[root@HIGDQEEMO63U9NR ~]#
```

由于 WSL的这个Centos包中 不能使用 systemd ，使用 service 时会出现错误提示，
这里不注册为 service ，而是使用软链接的方式来省略 nginx 命令的路径前缀。
```
ln -s /usr/sbin/nginx /usr/bin/nginx  # 可以不执行
nginx  # 启动服务，访问127.0.0.1可以看到nginx欢迎界面
nginx -s reload  # 不停止服务重新载入配置文件
nginx -s stop  # 停止服务
```

**配置**

看一下 `/etc/nginx/nginx.conf` 内容：
```
user  nginx;
worker_processes  auto;

error_log  /var/log/nginx/error.log notice;
pid        /var/run/nginx.pid;


events {
    worker_connections  1024;
}


http {
    include       /etc/nginx/mime.types;
    default_type  application/octet-stream;

    log_format  main  '$remote_addr - $remote_user [$time_local] "$request" '
                      '$status $body_bytes_sent "$http_referer" '
                      '"$http_user_agent" "$http_x_forwarded_for"';

    access_log  /var/log/nginx/access.log  main;

    sendfile        on;
    #tcp_nopush     on;

    keepalive_timeout  65;

    #gzip  on;

    include /etc/nginx/conf.d/*.conf;
}
```

我们可以在最下面include后补充一句：
```
include /mnt/d/www/vhost/*.conf;
```

在`/etc/nginx/conf.d/`目录下只有 `default.conf`一个文件，就是上面Nginx欢迎页的配置，看一下内容：
```
server {
    listen       80;
    server_name  localhost;

    #access_log  /var/log/nginx/host.access.log  main;

    location / {
        root   /usr/share/nginx/html;
        index  index.html index.htm;
    }

    #error_page  404              /404.html;

    # redirect server error pages to the static page /50x.html
    #
    error_page   500 502 503 504  /50x.html;
    location = /50x.html {
        root   /usr/share/nginx/html;
    }

    # proxy the PHP scripts to Apache listening on 127.0.0.1:80
    #
    #location ~ \.php$ {
    #    proxy_pass   http://127.0.0.1;
    #}

    # pass the PHP scripts to FastCGI server listening on 127.0.0.1:9000
    #
    #location ~ \.php$ {
    #    root           html;
    #    fastcgi_pass   127.0.0.1:9000;
    #    fastcgi_index  index.php;
    #    fastcgi_param  SCRIPT_FILENAME  /scripts$fastcgi_script_name;
    #    include        fastcgi_params;
    #}

    # deny access to .htaccess files, if Apache's document root
    # concurs with nginx's one
    #
    #location ~ /\.ht {
    #    deny  all;
    #}
}
```

我们可以类似在`D:\www\vhost\`中写一个自己的项目的配置文件`abc.test.conf`：
```
server {
    listen       80;
    server_name  abc.test;

    location / {
        root   /mnt/d/www/abc;
        index  index.html index.htm;
    }

    # redirect server error pages to the static page /50x.html
    #
    error_page   500 502 503 504  /50x.html;
    location = /50x.html {
        root   /usr/share/nginx/html;
    }
}
```

在`D:\www\abc\`中写一个index.html文件，内容自己定义。

在 `C:\Windows\System32\drivers\etc\hosts` 文件最下面增加一行：
```
127.0.0.1      abc.test
```

然后启动Nginx：
> nginx

如果已经启动了，那就重启：
> nginx -s reload

打开浏览器，访问 abc.test ，可以看到效果。

### 安装PHP

### 安装MySQL



<br/><br/><br/><br/><br/>
## 参考资料

Win+Linux单系统解决方案——WSL（入门篇） <https://www.jianshu.com/p/6b02948b3d37>

在Windows 10上使用WSL安装Centos <https://zhuanlan.zhihu.com/p/272735470>

漫谈在Windows Server 2019中安装使用WSL <https://zhuanlan.zhihu.com/p/271927065>

适用于 Linux 的 Windows 子系统安装指南 (Windows 10) <https://docs.microsoft.com/zh-cn/windows/wsl/install-win10>

CentWSL Tags包 <https://github.com/wsldl-pg/CentWSL/tags>

Win10 WSL安装Centos7 Nginx+PHP+MySQL <https://blog.csdn.net/hudeyong926/article/details/101030622>

nginx: Linux packages <http://nginx.org/en/linux_packages.html>

centos yum-utils包详解 <https://blog.csdn.net/xixihahalelehehe/article/details/105625710>

如何安装和使用'yum-utils'来维护Yum并提高其性能 <https://www.howtoing.com/linux-yum-package-management-with-yum-utils/>

Yum-utils  剖析 <https://blog.csdn.net/xiaoxiao_22/article/details/7044583>

WSL2子系统安装CentOS8及源码编译安装Nginx1.18+PHP7.4+MySql8.0开发 <https://blog.51cto.com/u_15057852/2567230>

