---
layout: post
categories: Linux
title: Centos7.9 持续集成与部署
meta: Centos7.9 持续集成与部署
---
* content
{:toc}

## 正文

![]({{site.baseurl}}/images/20220221/20220221104248.png)

DevOps（Development和Operations的组合词）是一组过程、方法与系统的统称，
用于促进开发（应用程序/软件工程）、技术运营和质量保障（QA）部门之间的沟通、协作与整合。

它是一种重视“软件开发人员（Dev）”和“IT运维技术人员（Ops）”之间沟通合作的文化、运动或惯例。
透过自动化“软件交付”和“架构变更”的流程，来使得构建、测试、发布软件能够更加地快捷、频繁和可靠。
它的出现是由于软件行业日益清晰地认识到：为了按时交付软件产品和服务，开发和运维工作必须紧密合作。

CI（Continuous Integration）持续集成是借助工具对软件项目进行持续的自动化的编译打包构建测试发布，来检查软件交付质量的一种行为。
而CD（Continuous Delivery）持续部署是基于持续交付的优势自动将经过测试的代码推入生产环境的过程。

![]({{site.baseurl}}/images/20220221/20220221104250.png)

![]({{site.baseurl}}/images/20220221/20220221104252.png)

![]({{site.baseurl}}/images/20220221/20220221104500.png)

![]({{site.baseurl}}/images/20220221/20220221104506.png)

![]({{site.baseurl}}/images/20220221/20220221104613.png)

![]({{site.baseurl}}/images/20220221/20220221104617.png)

### 私有仓库搭建

拉取镜像
> docker pull registry

创建容器
```
> docker run --name registry --privileged=true -p 5000:5000 -v /opt/registry:/var/lib/registry -d registry
```

Registry服务默认会将上传的镜像保存在容器的`/var/lib/registry`，我们将主机的`/opt/registry`目录挂载到该目录，
即可实现将镜像保存到主机的`/opt/registry`目录了。

```
[root@localhost ~]# docker pull registry
Using default tag: latest
Trying to pull repository docker.io/library/registry ...
latest: Pulling from docker.io/library/registry
59bf1c3509f3: Pull complete
666ba61612fd: Pull complete
a4642f78634a: Pull complete
9ab650d99063: Pull complete
91dceb018e81: Pull complete
Digest: sha256:c26590bcf53822a542e78fab5c88e1dfbcdee91c1882f4656b7db7b542d91d97
Status: Downloaded newer image for docker.io/registry:latest
[root@localhost ~]#
[root@localhost ~]# docker images
REPOSITORY           TAG                 IMAGE ID            CREATED             SIZE
docker.io/registry   latest              9c97225e83c8        2 weeks ago         24.2 MB
docker.io/nginx      latest              c316d5a335a5        3 weeks ago         142 MB
docker.io/php        7.1.30-fpm          0b13895891aa        2 years ago         391 MB
[root@localhost ~]#
[root@localhost ~]#
[root@localhost ~]# docker run --name registry --privileged=true -p 5000:5000 -v /opt/registry:/var/lib/registry -d registry
e8314bf2b462d004e767661f3a7d8371ec4eee6ff89a451526dad8181fbc9d1e
[root@localhost ~]#
[root@localhost ~]# docker ps -a
CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                    NAMES
e8314bf2b462        registry            "/entrypoint.sh /e..."   6 seconds ago       Up 4 seconds        0.0.0.0:5000->5000/tcp   registry
813daeef096d        nginx               "/docker-entrypoin..."   5 days ago          Up 4 days           0.0.0.0:80->80/tcp       server-nginx
83199b3ed9ba        php:7.1.30-fpm      "docker-php-entryp..."   5 days ago          Up 2 hours          0.0.0.0:9000->9000/tcp   server-php
[root@localhost ~]#
```

配置私有仓库地址
> vim /etc/docker/daemon.json

加入一行：
```
{"insecure-registries": [192.168.56.108:5000]}
```

重新加载配置
> sudo systemctl daemon-reload

重启启动 docker
> sudo systemctl restart docker

访问：`http://192.168.56.108:5000/v2/_catalog`，返回：
```
{"repositories":[]}
```

```
[root@localhost ~]# vim /etc/docker/daemon.json
[root@localhost ~]#
[root@localhost ~]# systemctl daemon-reload
[root@localhost ~]#
[root@localhost ~]# docker ps -a
CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                    NAMES
e8314bf2b462        registry            "/entrypoint.sh /e..."   About an hour ago   Up About an hour    0.0.0.0:5000->5000/tcp   registry
813daeef096d        nginx               "/docker-entrypoin..."   5 days ago          Up 4 days           0.0.0.0:80->80/tcp       server-nginx
83199b3ed9ba        php:7.1.30-fpm      "docker-php-entryp..."   5 days ago          Up 3 hours          0.0.0.0:9000->9000/tcp   server-php
[root@localhost ~]#
[root@localhost ~]# systemctl restart docker
[root@localhost ~]#
[root@localhost ~]# docker ps -a
CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS                    NAMES
e8314bf2b462        registry            "/entrypoint.sh /e..."   About an hour ago   Up About an hour    0.0.0.0:5000->5000/tcp   registry
813daeef096d        nginx               "/docker-entrypoin..."   5 days ago          Up 4 days           0.0.0.0:80->80/tcp       server-nginx
83199b3ed9ba        php:7.1.30-fpm      "docker-php-entryp..."   5 days ago          Up 3 hours          0.0.0.0:9000->9000/tcp   server-php
[root@localhost ~]#
```

#启动本地仓库容器
docker start 容器ID

### GitLab安装



### Jenkins安装





<br/><br/><br/><br/><br/>
## 参考资料

艾编程：Jenkins持续集成安装部署到项目开发实战详细教程合集 <https://www.bilibili.com/video/BV1Gi4y1472V?p=1>

持续集成与持续部署.md <https://github.com/liuurick/BlogBackup/blob/master/source/_posts/持续集成与持续部署.md>

Jenkins持续集成安装部署到项目开发实战详细教程合集 <https://www.ixigua.com/6827368436994146828?id=6826944095340986887&logTag=bf984e310528060469b9>

Jenkins详细教程 <https://www.jianshu.com/p/5f671aca2b5a>

Jenkins 官网 <https://www.jenkins.io/zh/>

你知道什么是CI/CD吗？不懂？五分钟让你彻底理解！ <https://zhuanlan.zhihu.com/p/381514438>


