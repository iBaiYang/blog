---
layout: post
categories: Linux
title: Linux php7.1 apt安装
meta: Linux php7.1 apt安装
---
* content
{:toc}

### 正文

#### 安装php7.1、php-fpm

添加可获取php的apt源：
```
vim /etc/apt/sources.list
```

把这一行也加上，然后保存退出：
```
deb https://packages.sury.org/php/ stretch main
```

更新源：
```
apt update
```

安装php7.1：
```
apt install php7.1 php7.1-fpm php7.1-bcmath php7.1-bz2 php7.1-cgi php7.1-cli php7.1-common php7.1-curl php7.1-dba php7.1-dev php7.1-enchant php7.1-gd php7.1-gmp php7.1-imap php7.1-interbase php7.1-intl php7.1-json php7.1-ldap php7.1-mbstring php7.1-mcrypt php7.1-mysql php7.1-odbc php7.1-opcache php7.1-pgsql php7.1-phpdbg php7.1-pspell php7.1-readline php7.1-recode php7.1-snmp php7.1-soap php7.1-sqlite3 php7.1-sybase php7.1-tidy php7.1-xml php7.1-xmlrpc php7.1-xsl php7.1-zip
```

等待完成就算是安装好了，我们可以看一下版本：
```
php -v
```

#### 修改php-fpm配置

不过现在php-fpm用的是socket方式，我们要改成9000端口方式：

看一下php-fpm.conf的配置：
```
vi /etc/php/7.1/fpm/php-fpm.conf  
```
发现这里没有listen监听的配置，不过看到了最后一行： include=/etc/php/7.1/fpm/pool.d/*.conf

我们到/etc/php/7.1/fpm/pool.d/发现有www.conf，我们看一下这个文件：
```
vi /etc/php/7.1/fpm/pool.d/www.conf
```
在这个文件中看到了listen监听的配置：
```
listen = /run/php/php7.1-fpm.sock
```
看到这里监听的是socket方式，我们把这一行屏蔽掉，加入新的一行：
```
;listen = /run/php/php7.1-fpm.sock
listen = 127.0.0.1:9000
```

好，配置也修改完毕，接下来重启php-fpm:
```
service php7.1-fpm restart
```

然后访问站点就可以了。

如果这里用socket方式，则Nginx中项目的配置是：
```
location ~ \.php$ {
    include fastcgi_params;
    fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;
    #fastcgi_pass 127.0.0.1:9000;
    fastcgi_pass unix:/run/php/php7.1-fpm.sock;
    try_files $uri =404;
}
```

#### 查看相关

看一下php-fpm服务状态：
```
service php7.1-fpm status
```

看一下php-fpm进程：
```
ps -ef |grep php-fpm
```

看一下php-fpm进程关系：
```
systemctl status |grep php-fpm
```

看一下端口9000在不在监听中：
```
netstat -apnt 
```

![](https://raw.githubusercontent.com/iBaiYang/PictureWareroom/master/20191219/20191219215121.png)

#### 安装php7.2

附带看一下php7.2的安装：
```
sudo apt install php7.2 php7.2-fpm php7.2-bcmath php7.2-bz2 php7.2-cgi php7.2-cli php7.2-common php7.2-curl php7.2-dba php7.2-dev php7.2-enchant php7.2-gd php7.2-gmp php7.2-imap php7.2-interbase php7.2-intl php7.2-json php7.2-ldap php7.2-mbstring php7.2-mysql php7.2-odbc php7.2-opcache php7.2-pgsql php7.2-phpdbg php7.2-pspell php7.2-readline php7.2-recode php7.2-snmp php7.2-soap php7.2-sqlite3 php7.2-sybase php7.2-tidy php7.2-xml php7.2-xmlrpc php7.2-xsl php7.2-zip
```

#### 安装redis拓展

有时项目中需要连接redis，就要用到php的redis拓展，我们以管理员身份安装一下：
```
apt install php7.1-redis
```

发现自动选择了php-redis拓展，还有依赖的几个包也自动安装了。

我们用查看下php拓展可以看到已经有了：
```
php -m
```

不过现在web访问查看phpinfo()还没有，我们需要重启一下php-fpm：
```
service php7.1-fpm restart
```

然后就可以看到有了：
```
<?php
phpinfo();
exit;
```

#### 安装mbstring拓展

> sudo apt-get install php7.1-mbstring

查看php配置文件：

> sudo find / -name php.ini

输出：
```
/etc/php/7.1/fpm/php.ini
/etc/php/7.1/cgi/php.ini
/etc/php/7.1/cli/php.ini
```

我们修改php.ini：

> sudo vim /etc/php/7.1/fpm/php.ini

把下面这行加到文档中：

```
extension=mbstring.so
```

#### 安装json拓展

> sudo apt-get install php7.1-json

我们修改php.ini：

> sudo vim /etc/php/7.1/cli/php.ini

把下面这行加到文档中：

```
extension=json.so
```

#### 安装amqp拓展

> sudo apt-get install php7.1-amqp

我们修改php.ini：

> sudo vim /etc/php/7.1/cli/php.ini

把下面这行加到文档中：

```
extension=amqp.so
```

保存后，查看下php的拓展模块有哪些：

> php -m

可以看到输出中已经有了：
```
[PHP Modules]
amqp
Core
date
filter
hash
json
libxml
mbstring
openssl
pcntl
pcre
Reflection
session
SPL
standard
zlib

[Zend Modules]
```

这种拓展安装方式比编译安装方便了不少，解决了依赖安装的问题。

#### 安装ctype拓展

> sudo apt-get install php7.1-ctype

通过Nginx访问的都是通过php-fpm进行的，所以如果web访问报缺拓展的错误，我们install拓展后，需要修改fpm下的php.ini：

> sudo vim /etc/php/7.1/fpm/php.ini

把下面这行加到文档中：

```
extension = ctype.so
```

#### 安装pdo_mysql拓展

> sudo apt-get install php7.1-mysql

pdo_mysql的前置关键基础要素是mysqlnd，我们也要加上：
```
extension = mysqlnd.so
extension = pdo_mysql.so
```

<br/><br/><br/><br/><br/>
### 参考资料

deepin安装PHP7  <https://bbs.deepin.org/forum.php?mod=viewthread&tid=156235&extra=>

深度 Linux 搭建 PHP 开发环境 <https://www.jianshu.com/p/d44e912bf1b7>

如何查找php-fpm监听的端口 <https://www.cnblogs.com/cjjjj/p/10548367.html>

PHP 7 ChangeLog 更新日志 <https://www.php.net/ChangeLog-7.php>

