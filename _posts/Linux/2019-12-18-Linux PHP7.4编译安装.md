---
layout: post
categories: Linux
title: Linux PHP7.4编译安装
meta: Linux PHP7.4编译安装
---
* content
{:toc}

### 正文

在项目中用composer安装一个vendor拓展包报错了，要求PHP必须大于7.1，然而我的是7.0，没办法,只能升级本地PHP了，直接升级成现在现在最新的7.4。

先去PHP官网下载安装包：

<https://www.php.net/downloads.php>

然后解压到指定目录：

```
tar -xzvf php-7.4.0.tar.gz
```

![](https://raw.githubusercontent.com/iBaiYang/PictureWareroom/master/20191218/20191218153509.png)

到解压目录下:
```
cd php-7.4.0
```

以su管理员身份运行，configure配置：
```
./configure --prefix=/usr/local/php --with-curl --with-gettext --with-iconv-dir --with-kerberos --with-libdir=lib64 --with-mysqli --with-openssl --with-pdo-mysql --with-pdo-sqlite --with-pear --with-xmlrpc --with-xsl --with-zlib --with-bz2 --with-mhash --enable-fpm --enable-bcmath --enable-inline-optimization --enable-mbregex --enable-mbstring --enable-opcache --enable-pcntl --enable-shmop --enable-soap --enable-sockets --enable-sysvsem --enable-sysvshm --enable-xml
```

会报错，有包缺失，未生成makefile，make时报错：
```
make: *** 没有指明目标并且找不到 makefile。 停止。
```

看来只能只能配置最核心的几个包了：
```
./configure --prefix=/usr/local/php --with-mysqli --with-pdo-mysql --with-pdo-sqlite --enable-fpm 
```

--prefix=/usr/local/php 是说安装到 /usr/local/php 目录下。

完成结果：

![](https://raw.githubusercontent.com/iBaiYang/PictureWareroom/master/20191218/20191218155938.png)

然后make编译：
```
make
```

可以看到编译成功，提示make test：

![](https://raw.githubusercontent.com/iBaiYang/PictureWareroom/master/20191218/20191218155212.png)

完成后，提示有一个错误:

![](https://raw.githubusercontent.com/iBaiYang/PictureWareroom/master/20191218/20191218160259.png)

可以不管，我们直接安装：
```
make install
```

![](https://raw.githubusercontent.com/iBaiYang/PictureWareroom/master/20191218/20191218160614.png)

安装完成，接下来就是具体配置，我们到 /usr/local/php 看一下：

![](https://raw.githubusercontent.com/iBaiYang/PictureWareroom/master/20191218/20191218162410.png)

cp复制 php-fpm.conf.default 为 php-fpm.conf：
```
cp /usr/local/php/etc/php-fpm.conf.default /usr/local/php/etc/php-fpm.conf
```

然后：
```
vim /usr/local/php/etc/php-fpm.conf
```

打开屏蔽行，保存退出：
```
pid = run/php-fpm.pid
```

![](https://raw.githubusercontent.com/iBaiYang/PictureWareroom/master/20191218/20191218162542.png)

cp复制 www.conf.default 为 www.conf：
```
cp /usr/local/php/etc/php-fpm.d/www.conf.default /usr/local/php/etc/php-fpm.d/www.conf
```

然后：
```
vim /usr/local/php/etc/php-fpm.d/www.conf
```

修改用户和用户组，以为原来、包括Nginx都是www-data，所以这里也改成这个用户和用户组，保存退出：
```
user = www-data
group = www-data
```

![](https://raw.githubusercontent.com/iBaiYang/PictureWareroom/master/20191218/20191218163450.png)

这样就配置好了，接下来就是启动。

我们可以把系统中运行的旧的php-fpm的进程查看有没有：
```
ps aux | grep php-fpm
```

如果有停掉，数字是进程id号：
```
kill -9 3916 3917 3915
```

然后启动php-fpm:
```
/usr/local/php/sbin/php-fpm
```

![](https://raw.githubusercontent.com/iBaiYang/PictureWareroom/master/20191218/20191218180130.png)

<br/><br/><br/><br/><br/>
### 参考资料

PHP安装包下载 <https://www.php.net/downloads.php>

php-fpm安装、配置与优化 <https://blog.csdn.net/resilient/article/details/82420863>

php中fastcgi和php-fpm是什么东西 <https://www.zybuluo.com/phper/note/50231>

php-fpm的安装和启动 <https://www.zybuluo.com/phper/note/72879>

linux上nginx的安装启动以及配合php-fpm的使用 <https://www.zybuluo.com/phper/note/73025>

php-fpm的配置和优化 <https://www.zybuluo.com/phper/note/89081>

PHP 手册 安装与配置 FastCGI 进程管理器（FPM） 配置 <https://www.php.net/manual/zh/install.fpm.configuration.php>


