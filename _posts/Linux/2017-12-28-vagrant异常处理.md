---
layout: post
categories: Linux
title: vagrant异常处理
meta: vagrant启动异常处理，打包重装
---
* content
{:toc}

### 正文

<http://blog.sina.com.cn/s/blog_6aba78b40102xa1g.html>

一般我们vagrant up后，关机时都会vagrant halt，（vagrant destroy会丢失linux上安装的软件，如php、nginx、mysql等等，所以不要用destroy），但有一次win10电脑升级时自动重启了电脑，然后vagrant就不能启动了。

查看状态，是poweroff；强制halt，没有变，理论上也不会变；强制重启，有问题。

![]({{site.baseurl}}/images/20211028/20211028114961.jpg)

直接up启动，下面报错。

![]({{site.baseurl}}/images/20211028/20211028114963.jpg)

强制reload也不行。

![]({{site.baseurl}}/images/20211028/20211028114964.jpg)

看来要重新安装了，package把LNMP环境打包一下，已备使用。把配置文件也备份了。

![]({{site.baseurl}}/images/20211028/20211028114967.jpg)

destroy后再重启，也无济于事。

![]({{site.baseurl}}/images/20211028/20211028114969.jpg)

其实destroy可以从内存中清除所有预载环境。

![]({{site.baseurl}}/images/20211028/20211028114971.jpg)

把我们的虚拟环境remove了吧。

![]({{site.baseurl}}/images/20211028/20211028114973.jpg)

重新add试试，init看看。

![]({{site.baseurl}}/images/20211028/20211028114975.jpg)

init前把目录下的这两个删除了，然后init，生成配置文件，当然里面的配置是新的，我们把之前备份的配置文件复制替换它。

![]({{site.baseurl}}/images/20211028/20211028114977.jpg)

接着up看看，还是同样的问题。

![]({{site.baseurl}}/images/20211028/20211028114979.jpg)

destroy后remove了吧。

![]({{site.baseurl}}/images/20211028/20211028114981.jpg)

 只能重装virtualBox了，是virtualBox5.0.36的原因，有东西遗留在电脑硬件中了，重装win10系统都不能解决问题、顺利up。

---

下面是解决问题的方法——重装，当然你也可以用package包：

重装virtualBox，版本降级为：4.3.12

![]({{site.baseurl}}/images/20211028/20211028114983.jpg)

cmd到vagrant目录下 box add：

![]({{site.baseurl}}/images/20211028/20211028114984.jpg)

当init时报错，把跟目录下的原来的配置文件删了，包括.vagrant文件夹和Vagrantfile：

![]({{site.baseurl}}/images/20211028/20211028114987.jpg)

然后重新init：

![]({{site.baseurl}}/images/20211028/20211028114989.jpg)

看一下根目录：

![]({{site.baseurl}}/images/20211028/20211028114991.jpg)

修改配置文件为：

![]({{site.baseurl}}/images/20211028/20211028114993.jpg)

![]({{site.baseurl}}/images/20211028/20211028114994.jpg)

然后up，可以看到进度：

![]({{site.baseurl}}/images/20211028/20211028114995.jpg)

结果发现有报错，80端口被占用：

![]({{site.baseurl}}/images/20211028/20211028114999.jpg)

把wamp等其他环境全部关闭并退出。重新up，结束后：

![]({{site.baseurl}}/images/20211028/20211028115001.jpg)

看一下状态：

![]({{site.baseurl}}/images/20211028/20211028115003.jpg)

看一下根目录：

![]({{site.baseurl}}/images/20211028/20211028115005.jpg)

顺利启动。如果up不能成功，就用vagrant reload。



<br/><br/><br/><br/><br/>
### 参考资料 

<http://www.pangyiguang.com/blog/93.html>

<http://blog.sina.com.cn/s/blog_6aba78b40102x297.html>


