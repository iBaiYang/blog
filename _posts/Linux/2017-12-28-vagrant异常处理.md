---
layout: post
categories: Linux
title: vagrant异常处理
meta: vagrant启动异常处理，打包重装
---
* content
{:toc}

### 正文

一般我们vagrant up后，关机时都会vagrant halt，（vagrant destroy会丢失linux上安装的软件，如php、nginx、mysql等等，所以不要用destroy），但有一次win10电脑升级时自动重启了电脑，然后vagrant就不能启动了。

查看状态，是poweroff；强制halt，没有变，理论上也不会变；强制重启，有问题。

![](http://s7.sinaimg.cn/mw690/001XbchKzy7gWh05FpY26&690)

直接up启动，下面报错。

![](http://s15.sinaimg.cn/mw690/001XbchKzy7gWh27giaee&690)

强制reload也不行。

![](http://s7.sinaimg.cn/mw690/001XbchKzy7gWh45NUGf6&690)

看来要重新安装了，package把LNMP环境打包一下，已备使用。把配置文件也备份了。

![](http://s10.sinaimg.cn/mw690/001XbchKzy7gWh5CNjH09&690)

destroy后再重启，也无济于事。

![](http://s11.sinaimg.cn/mw690/001XbchKzy7gWh5H5Lcda&690)

其实destroy可以从内存中清除所有预载环境。

![](http://s8.sinaimg.cn/mw690/001XbchKzy7gWh60Vx5a7&690)

把我们的虚拟环境remove了吧。

![](http://s1.sinaimg.cn/mw690/001XbchKzy7gWh5KwtW00&690)

重新add试试，init看看。

![](http://s10.sinaimg.cn/mw690/001XbchKzy7gWh7yQg979&690)

init前把目录下的这两个删除了，然后init，生成配置文件，当然里面的配置是新的，我们把之前备份的配置文件复制替换它。

![](http://s15.sinaimg.cn/mw690/001XbchKzy7gWhQSrGCae&690)

接着up看看，还是同样的问题。

![](http://s8.sinaimg.cn/mw690/001XbchKzy7gWh7CJpB87&690)

destroy后remove了吧。

![](http://s14.sinaimg.cn/mw690/001XbchKzy7gWi6X4ux3d&690)

 只能重装virtualBox了，是virtualBox5.0.36的原因，有东西遗留在电脑硬件中了，重装win10系统都不能解决问题、顺利up。

---

下面是解决问题的方法——重装，当然你也可以用package包：

重装virtualBox，版本降级为：4.3.12

![](http://s4.sinaimg.cn/mw690/001XbchKzy7hlA4LRoDd3&690)

cmd到vagrant目录下 box add：

![](http://s15.sinaimg.cn/mw690/001XbchKzy7hlA6N9Yqde&690)

当init时报错，把跟目录下的原来的配置文件删了，包括.vagrant文件夹和Vagrantfile：

![](http://s1.sinaimg.cn/mw690/001XbchKzy7hlAfi0q4f0&690)

然后重新init：

![](http://s9.sinaimg.cn/mw690/001XbchKzy7hlAspEiQ68&690)

看一下根目录：

![](http://s8.sinaimg.cn/mw690/001XbchKzy7hlAfPnzF97&690)

修改配置文件为：

![](http://s8.sinaimg.cn/mw690/001XbchKzy7hlAgnilhf7&690)

![](http://s4.sinaimg.cn/mw690/001XbchKzy7hlAgQ0Ond3&690)

然后up，可以看到进度：

![](http://s10.sinaimg.cn/mw690/001XbchKzy7hlAhhOxXc9&690)

结果发现有报错，80端口被占用：

![](http://s1.sinaimg.cn/mw690/001XbchKzy7hlAxyGOs20&690)

把wamp等其他环境全部关闭并退出。重新up，结束后：

![](http://s15.sinaimg.cn/mw690/001XbchKzy7hlAF2r7wfe&690)

看一下状态：

![](http://s7.sinaimg.cn/mw690/001XbchKzy7hlAHh67436&690)

看一下根目录：

![](http://s14.sinaimg.cn/mw690/001XbchKzy7hlAQQSWpdd&690)

顺利启动。如果up不能成功，就用vagrant reload。



<br/><br/><br/><br/><br/>
### 参考资料 

<http://www.pangyiguang.com/blog/93.html>

<http://blog.sina.com.cn/s/blog_6aba78b40102x297.html>


