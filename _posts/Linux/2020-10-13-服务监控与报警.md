---
layout: post
categories: Linux
title: 服务监控与报警
meta: 服务监控与报警
---
* content
{:toc}

### 正文

我们下面使用Prometheus和Grafana对本机服务器性能进行监控。

监控本机，只需要一个exporter。 node_exporter，用于机器系统数据收集。

下面选择用docker实现Prometheus和Grafana。

#### node_exporter安装

下载镜像包：
> sudo docker pull prom/node-exporter

启动node-exporter：
```
sudo docker run -d -p 9100:9100 \
  -v "/proc:/host/proc:ro" \
  -v "/sys:/host/sys:ro" \
  -v "/:/rootfs:ro" \
  --net="host" \
  prom/node-exporter
```

单行格式：
```
sudo docker run -d -p 9100:9100 -v "/proc:/host/proc:ro" -v "/sys:/host/sys:ro" -v "/:/rootfs:ro" --net="host" prom/node-exporter
```

其中目录映射的：`/proc` 正在运行的内核信息映射，主要输出 进程信息、内存资源信息、磁盘分区信息等等；`/sys` 硬件设备的驱动程序信息。

等待几秒，查看端口是否起来：
> netstat -anpt

访问url：`http://127.0.0.1:9100/metrics` ，可以看到收集到数据，有了它就可以做数据展示了。

#### Prometheus安装

下载镜像包：
> sudo docker pull prom/prometheus

新建目录prometheus，编辑配置文件prometheus.yml：
> cd ~/worksoft
> mkdir prometheus
> cd prometheus
> vim prometheus.yml

写入配置：
```
global:
  scrape_interval:  60s
  evaluation_interval: 60s
 
scrape_configs:
  - job_name: prometheus
    static_configs:
      - targets: ['localhost:9090']
        labels:
          instance: prometheus
 
  - job_name: linux
    static_configs:
      - targets: ['127.0.0.1:9100']
        labels:
          instance: localhost
```

注意：这里的127.0.0.1:9100就是本机上面的node-exporter地址。


#### Grafana安装

下载镜像包：
> sudo docker pull grafana/grafana



#### Prometheus+Grafana监控与报警

[基于docker 搭建Prometheus+Grafana](https://www.cnblogs.com/xiao987334176/p/9930517.html)

<br/><br/><br/><br/><br/>
### 参考资料

Prometheus+Grafana监控与报警 <https://www.cnblogs.com/miaocbin/p/12009974.html>

基于docker 搭建Prometheus+Grafana <https://www.cnblogs.com/xiao987334176/p/9930517.html>

linux下 /proc 和 /sys 详解 <https://blog.csdn.net/z1026544682/article/details/98092139>


