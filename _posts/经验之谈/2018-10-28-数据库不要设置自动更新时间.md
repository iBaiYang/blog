---
layout: post
categories: 经验之谈
title: 数据库不要设置自动更新时间
meta: 数据库不要设置自动更新时间
---
* content
{:toc}

### 正文

有时DBA会建议给表加上自动填写创建时间和自动更新更新时间，这样会防止程序员漏写时间的问题。

初听之下，确实挺方便的，然后就加上了：

```
  `created_time` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP COMMENT '添加时间',
  `updated_time` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP COMMENT '修改时间',
```

刚用之下，也没发现什么不好，逻辑里还不用写时间相关的代码了。随着时间的推移，业务逐渐复杂，
然后各种无奈和将就：

1、有时需要修改表中一个字段，但更新时间不能变。

2、日志表和记录表中创建时间不一致的问题。

先来说一下第一个问题：有时需要修改表中一个字段，但更新时间不能变。这就需要我们先拿到修改数据的更新时间，
然后在update时把拿到的时间重新赋值写回去。一条数据还好，多条数据呢？不能整体修改，必须循环一条一条去更新了！

再来说第二个问题：日志表和记录表中创建时间不一致的问题。有时我们会对这次操作记录操作日志，
如果数据操作写入数据库的时间和日志写入数据库的时间刚好错过1秒的分界线，这就会是两个时间，
为什么数据更新时间和日志中记录的写入时间不一致？是不是有一次操作漏写了？这种情况就比较严重了！

一般我们会对日志表和记录表的时间都用一个时间，也就是直接对时间赋值，然后才写入数据库，既然这样，
那为什么还要给数据表加自动填写创建时间和自动更新更新时间？而且还有第一种情况的存在。

其实一个严谨的程序员，所有相关时间都是自己赋值操作的，不会漏写相关时间。而且就数据库而言，
数据库只应该做数据存储的事情，不应参入任何逻辑；再者，程序必须占据主导地位，
具有数据操作的完全权限，不能外让相关权限，致使对数据的操作能力受损。


<br/><br/><br/><br/><br/>
### 参考资料



