---
layout: post
categories: PHP
title: PHP 拾遗
meta: PHP 拾遗
---
* content
{:toc}

## json_encode

原来只知道`json_encode()`可以把数组格式化为json格式，原来`json_encode()`还可以把字符串格式化为json格式，
不过对该格式化后的json对象，使用`json_decode($json)`后还是字符串，而不是数组。

如：
```php
<?php
$string = '{"name":"John", "age":30, "city":"New York"}';
$jsonArray = json_encode($string);

echo $jsonArray;  // 输出： "{\"name\":\"John\", \"age\":30, \"city\":\"New York\"}" 

echo json_decode($jsonArray, true);  // 输出：{"name":"John", "age":30, "city":"New York"} 
```

常规数组操作：
```php
<?php
$arr = ['name' => 'John', 'age' => 30, 'city' => 'New York'];
$str = json_encode($arr);
echo $str;  // {"name":"John","age":30,"city":"New York"}

$str2 = '{"name":"John","age":30,"city":"New York"}';
$arr2 = json_decode($str2, true);
print_r($arr2);
// 输出
Array
(
    [name] => John
    [age] => 30
    [city] => New York
)
```

字符串拼接：
```php
<?php
$str = '{' .'"name":"' .'John' .'","age":' .'30' .',"city":"' .'New York' .'"' .'}';
$arr = json_decode($str, true);
print_r($arr);
// 输出
Array
(
    [name] => John
    [age] => 30
    [city] => New York
)
```

参考地址 <https://www.php.net/manual/zh/function.json-encode.php>

函数原型：` json_encode(mixed $value, int $flags = 0, int $depth = 512): string|false`

$flags 参数的一种用法：`json_encode($arr, 320)`，会保留 / 和 中文。

如下：
```
<?php
$arr = ['/ a 你好'];

echo json_encode($arr);  // ["\/ a \u4f60\u597d"]

echo json_encode($arr, 320);  // ["/ a 你好"]
```


## array_map

`array_map()` 可以循环对数组内每个元素进行操作。

array_map()函数：多数组回调函数，将回调函数作用到给定数组的单元上 
1. 语法：`array array_map ( callback callback, array arr1 [, array ...] )` 
2. 描述：返回一个数组，该数组包含了 arr1 中的所有单元经过 callback 作用过之后的单元。
callback 接受的参数数目应该和传递给 array_map() 函数的数组数目一致。 
3. 注意事项1：多数组回调函数作用于一个数组时，将保留原有数组的键名，也就是返回的数组的键名就是作用到给定数组的键名 
4. 注意事项2：多数组回调函数作用于两个或多个数组时，他们的长度要一致，并且将忽略原来多个数组的键名，统一分配数字索引作为键名 

```php
 <?php
//单个数组使用的例子 
$websites = array("g" => "google", "b" => "baidu", "y" => "yahoo");
//输出原数组 
echo "<pre>";
print_r($websites);
echo "</pre>";
//定义对单个数组处理的回调函数 
function change_value($value)
{
    return ucfirst($value) . ".com";
}

$urls = array_map('change_value', $websites);
echo "<pre>";
print_r($urls);
echo "</pre>";
//多个数组使用的例子 
$arr1 = array(1, 3, 5, 7);
$arr2 = array(2, 4, 6, 8);
//定义对多个数组处理的回调函数 
function func1($a, $b)
{
    return $a * $b;
}

$results = array_map('func1', $arr1, $arr2);
echo "利用回调函数对多个数组处理后，返回的结果：<br>";
echo "<pre>";
print_r($results);
echo "</pre>"; 
```

输出：
```
Array
(
    [g] => google
    [b] => baidu
    [y] => yahoo
)

Array
(
    [g] => Google.com
    [b] => Baidu.com
    [y] => Yahoo.com
)

利用回调函数对多个数组处理后，返回的结果：

Array
(
    [0] => 2
    [1] => 12
    [2] => 30
    [3] => 56
)
```

对返回的元素可以进行合并，如`$string = implode(",", array_map($function, $array))`

array_map原型：
```
/**
 * Applies the callback to the elements of the given arrays
 * @link http://php.net/manual/en/function.array-map.php
 * @param callback $callback <p>
 * Callback function to run for each element in each array.
 * </p>
 * @param array $arr1 <p>
 * An array to run through the callback function.
 * </p>
 * @param array $_ [optional]
 * @return array an array containing all the elements of arr1
 * after applying the callback function to each one.
 * @since 4.0.6
 * @since 5.0
 */
function array_map($callback, array $arr1, array $_ = null) { }
```

## call_user_func

call_user_func — 把第一个参数作为回调函数调用，原型：
```
call_user_func(callable $callback, mixed ...$args): mixed
```

第一个参数 callback 是被调用的回调函数，其余参数是回调函数的参数。 

callback 可以是一个闭包函数、或者单个函数的函数名，也可以是一个类的静态函数、或者public函数。

看个例子：
```php
<?php
class myclass {
    public static function say_hello($data = '')
    {
        echo "Hello: $data!\n";
    }
	
	public function say_world($data = '')
    {
        echo "World: $data!\n";
    }
}

$classname = "myclass";
call_user_func(array($classname, 'say_hello'), 'tom');
call_user_func($classname .'::say_hello', 'cand');
call_user_func(array($classname, 'say_world'), 'sala');
call_user_func($classname .'::say_world', 'yeal');

$myobject = new myclass();
call_user_func(array($myobject, 'say_hello'), 'zhangsan');
call_user_func(array($classname, 'say_world'), 'lisi');

$classname = "myclass";
$actionname = "say_world";
call_user_func(array($classname, $actionname), 'adany');
call_user_func($classname .'::' .$actionname, 'jake');

// 输出
// Hello: tom!
// Hello: cand!
// World: sala!
// World: yeal!

// Hello: zhangsan!
// World: lisi!

// World: adany!
// World: jake!
```

因为这个函数特殊的用法，灵活使用，可以在项目中起到依赖注入的作用。

与这个函数相关内容有：
* call_user_func_array() - 调用回调函数，并把一个数组参数作为回调函数的参数
* is_callable() - 验证值是否可以在当前范围内作为函数调用。
* Variable functions 可变函数。这意味着如果一个变量名后有圆括号，PHP 将寻找与变量的值同名的函数，并且尝试执行它。可
* ReflectionFunction::invoke() - Invokes function
* ReflectionMethod::invoke() - Invoke



<br/><br/><br/><br/><br/>
## 参考资料


