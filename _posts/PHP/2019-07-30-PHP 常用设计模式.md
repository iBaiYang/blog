---
layout: post
categories: PHP
title: PHP 常用设计模式
meta: PHP 常用设计模式
---
* content
{:toc}

### 正文

#### 常用PHP设计模式

##### 工厂方法模式(Factory Method)

##### 模板方法模式(Template Method)

##### 策略模式(Strategy)

##### 迭代器模式(Iterator)

##### 命令模式(Command)

##### 适配器模式(Adapter)

##### 单例模式(Singleton)

单例模式（Singleton Pattern 单件模式或单元素模式）

单例模式确保某个类只有一个实例，而且自行实例化并向整个系统提供这个实例。

单例模式是一种常见的设计模式，在计算机系统中，线程池、缓存、日志对象、对话框、打印机、数据库操作、显卡的驱动程序常被设计成单例。

单例模式分3种：懒汉式单例、饿汉式单例、登记式单例。

单例模式有以下3个特点：

1．只能有一个实例。

2．必须自行创建这个实例。

3．必须给其他对象提供这一实例。

那么为什么要使用PHP单例模式？

PHP一个主要应用场合就是应用程序与数据库打交道的场景，在一个应用中会存在大量的数据库操作，针对数据库句柄连接数据库的行为，
使用单例模式可以避免大量的new操作。因为每一次new操作都会消耗系统和内存的资源。

```
class User 
{
    //静态变量保存全局实例
    private static $_instance = null;
    
    //私有构造函数，防止外界实例化对象
    private function __construct() {
    }
    
    //私有克隆函数，防止外办克隆对象
    private function __clone() {
    }
    
    //静态方法，单例统一访问入口
    static public function getInstance() 
    {
        if (is_null(self::$_instance) || isset(self::$_instance)) {
            self::$_instance = new self ();
        }
        return self::$_instance;
    }
    
    public function getName() 
    {
        echo 'hello world!';
    }
}
```

单例模式的优缺点：

优点：

1. 改进系统的设计

2. 是对全局变量的一种改进

缺点：

1. 难于调试

2. 隐藏的依赖关系

3. 无法用错误类型的数据覆写一个单例



单例模式特点:
* $_instance 必须声明为静态的私有变量
* 构造函数和克隆函数必须声明为私有的,这是为了防止外部程序 new 类从而失去单例模式的意义
* getInstance()方法必须声明为公有的,必须调用此方法以返回唯一实例的一个引用
* ::操作符只能访问静态变量或静态函数
* PHP的单例模式是相对而言的,因为PHP的解释运行机制使得每个PHP页面被解释执行后，所有的相关资源都会被回收。

示例单例：
```
class single
{
    public static $arr = ['host'=>'XXX','user'=>'XXX','password'=>'XXX'];
    
    private static $_instance =null;
    
    private function __construct(){}
    
    private function __clone(){}
    
    public static function getInstance()
    {
        if (self::$_instance== null || isset(self::$_instance)) {
            self::$_instance= new self;
        }
            return self::$_instance;   
    }
    
    public function showSomething()
    {
        return self::$arr;
    }
}
```

调用示例：
```
$a = single::getInstance();
print_r(single::getInstance()->showSomething());
```


$_instance必须声明为静态的私有变量
构造函数和析构函数必须声明为私有,防止外部程序new 类从而失去单例模式的意义
getInstance()方法必须设置为公有的,必须调用此方法 以返回实例的一个引用
::操作符只能访问静态变量和静态函数
new对象都会消耗内存
使用场景:最常用的地方是数据库连接。
使用单例模式生成一个对象后， 该对象可以被其它众多对象所使用。
私有的__clone()方法防止克隆对象

单例模式，使某个类的对象仅允许创建一个。构造函数private修饰，
申明一个static getInstance方法，在该方法里创建该对象的实例。如果该实例已经存在，则不创建。比如只需要创建一个数据库连接。

##### 观察者模式(Observer)


<br/><br/><br/><br/><br/>
### 参考资料

常见软件架构模式 <https://ibaiyang.github.io/blog/php/2019/07/30/%E5%B8%B8%E8%A7%81%E8%BD%AF%E4%BB%B6%E6%9E%B6%E6%9E%84%E6%A8%A1%E5%BC%8F.html>

PHP 设计模式概述 <https://segmentfault.com/a/1190000016629282>

PHP八大设计模式 <https://blog.csdn.net/flitrue/article/details/52614599>

php各种设计模式简单实践思考 <https://www.cnblogs.com/aksir/p/6777595.html>

工厂方法模式（Factory Method） <https://learnku.com/docs/php-design-patterns/2018/FactoryMethod/1489>

抽象工厂模式（Abstract Factory） <https://www.jianshu.com/p/7deb64f902db>

PHP设计模式-单例模式 <https://www.cnblogs.com/yangjinjin/archive/2013/01/31/2887492.html>

