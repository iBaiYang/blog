---
layout: post
categories: PHP
title: PHP 生成水印图片
meta: PHP 生成水印图片
---
* content
{:toc}

## 正文

视图页：
```
<img  src="<?php echo $this->createUrl('user/certificatemake'); ?>" alt="">
```

控制页：
```
public function actionCertificateMake(){
    $company = '公司名';
    $accout_type = '企业账户';
    $expire = (date('Y', $this->_user->agent_time)+$this->_user->expire).'年'.date('m月d日', $this->_user->agent_time);
    $time = date('Y年m月d日', $this->_user->agent_time);
 
    ob_clean();  // 清楚缓存，在生成验证码时有用

    $normal_font = Yii::getPathOfAlias('webroot').DIRECTORY_SEPARATOR.' static'.DIRECTORY_SEPARATOR.'font'.DIRECTORY_SEPARATOR.'simhei.ttf'; // 字体

    $handle = imagecreatefromjpeg(Yii::getPathOfAlias('webroot').DIRECTORY_SEPARATOR.' static'.DIRECTORY_SEPARATOR.'images'.DIRECTORY_SEPARATOR.'certificate.jpg');  // 图片底板

    imagealphablending($handle, true);  // 启用混合色模式，其实就是水印技术

    $black = imagecolorallocate($handle, 33,32, 30);  // 设置字体颜色

    imagefttext($handle, 16, 0, 242, 350, $black, $normal_font, $company); // 指定位置写入文本

    imagefttext($handle, 12, 0, 565, 400, $black, $normal_font, $this->_user->area?$this->_user->area:'----');

    imagefttext($handle, 12, 0, 215, 440, $black, $normal_font, $accout_type);

    imagefttext($handle, 12, 0, 295, 690, $black, $normal_font, $time.'-'.$expire);

    imagefttext($handle, 12, 0, 594, 185, $black, $normal_font, Y::U()->getId());

    imagefttext($handle, 12, 0, 510, 775, $black, $normal_font, $time);

   // 渲染输出图片          

    header('Content-Type: image/jpeg');

    imagejpeg($handle);

    imagedestroy ($handle);

    // 下载图片另存为

}
```

<br/><br/><br/><br/><br/>
## 参考资料

PHP 生成水印图片管理 <http://blog.sina.com.cn/s/blog_6aba78b40102whph.html>

