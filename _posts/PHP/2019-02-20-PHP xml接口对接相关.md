---
layout: post
categories: PHP
title: PHP xml接口对接相关
meta: 下面介绍下PHP中关于xml接口对接相关的内容
---
* content
{:toc}

### 正文

有时会碰到对接xml接口的场景，提交的参数是xml格式内容，返回的也是xml格式内容。

下面代码：

```
class Curl
{
    public static function post($url, $poststr = '')
    {
        //初始化
        $ch = curl_init();

        //设置选项，包括URL
        curl_setopt($ch, CURLOPT_URL, $url);
        curl_setopt($ch, CURLOPT_RETURNTRANSFER, 1);
        curl_setopt($ch, CURLOPT_POST, 1);
        curl_setopt($ch, CURLOPT_POSTFIELDS, $poststr);

        $output = curl_exec($ch);
        curl_close($ch);

        return $output;
    }
}

// 准备xml内容
$xml = '<?xml version="1.0" encoding="UTF-8"?>';
$xml .= '<Packet type="REQUEST" version="1.0">';
...
$xml .= '</Packet>';

$url = '接口RUL地址';

// 接口请求
$res_api = Curl::post($url, $xml);

// 接口返回结果处理
// 禁止引用外部xml实体
libxml_disable_entity_loader(true);
// 先把xml转换为simplexml对象，再把simplexml对象转换成 json，再将 json 转换成数组。
$res_array = json_decode(json_encode(simplexml_load_string($res_api, 'SimpleXMLElement', LIBXML_NOCDATA)), true);

// 业务逻辑
...
```

$res_array是对应的xml的array表示。

操作两次就知道具体怎么回事了。

<br/><br/><br/><br/><br/>
### 参考资料



