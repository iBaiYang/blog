---
layout: post
categories: Yii2
title: Yii2 四种缓存的使用 
meta: Yii2 四种缓存的使用 
---
* content
{:toc}

### 正文

<http://blog.sina.com.cn/s/blog_6aba78b40102x62r.html>

yii2的四种缓存是：
* 数据缓存
* 片段缓存
* 页面缓存
* HTTP 缓存

#### 1、数据缓存的使用例子：

在相应的试图view中，

>  use yii\caching\DbDependency; 

然后

```php
// 数据缓存示例
$data = Yii::$app->cache->get('postCount');
$dependency = new DbDependency( ['sql' => 'select count(id) from post'] );

if ( $data === false ) {
    $data = Post::find()->count();
    Yii::$app->cache->set('postCount', $data, 600, $dependency);
}

echo $data; 
```

![](https://raw.githubusercontent.com/iBaiYang/PictureWareroom/master/20200417/20200417132750.jpeg)

![](https://raw.githubusercontent.com/iBaiYang/PictureWareroom/master/20200417/20200417132751.jpeg)

![](https://raw.githubusercontent.com/iBaiYang/PictureWareroom/master/20200417/20200417132752.jpeg)

#### 2、片段缓存的使用例子：

在相应的试图view中，

>  use yii\caching\DbDependency; 

然后

```php
// 片段缓存示例
$dependency = new DbDependency( ['sql' => 'select count(id) from post'] );

if ( $this->beginCache('cache', ['duration' => 300], ['dependency' => $dependency]) ) {
    echo TagsCloudWidget::widget(['tags'=>$tags]);
    $this->endCache();
} 
```

![](https://raw.githubusercontent.com/iBaiYang/PictureWareroom/master/20200417/20200417132753.jpeg)

![](https://raw.githubusercontent.com/iBaiYang/PictureWareroom/master/20200417/20200417132754.jpeg)

上面两个完整页面示例代码地址：

<https://github.com/iBaiYang/yii2_weixi/blob/master/frontend/views/post/index.php>

#### 3、页面缓存的使用例子：

在相应的控制器的behaviors中：

```php
// 页面缓存
'pageCache' => [
    'class' => 'yii\filters\PageCache',
    'only' => ['index'],
    'duration' => 150,
    'variations' => [
        Yii::$app->request->get('page'),
        Yii::$app->request->get('PostSearch'),
        // Yii::$app->language,
    ],
    'dependency' => [
        'class' => 'yii\caching\DbDependency',
        'sql' => 'select count(id) from post',
    ],
], 
```

![](https://raw.githubusercontent.com/iBaiYang/PictureWareroom/master/20200417/20200417132755.jpeg)

#### 4、HTTP 缓存的使用例子：

在相应的控制器的behaviors中：

```php
 // HTTP缓存
'httpCache' => [
    'class' => 'yii\filters\HttpCache',
    'only' => ['detail'],
    'lastModified' => function ( $action, $params ) {
        $q = new \yii\db\Query();
        return $q->from('post')->max('update_time');
    },
    'etagSeed' => function ( $action, $params ) {
        $post = $this->findModel( Yii::$app->request->get('id') );
        return serialize( [$post->title, $post->content] );
    },
    'cacheControlHeader' => 'public, max-age=600',
], 
```

![](https://raw.githubusercontent.com/iBaiYang/PictureWareroom/master/20200417/20200417132756.jpeg)

这两个的完整页面示例代码地址：

<https://github.com/iBaiYang/yii2_weixi/blob/master/frontend/controllers/PostController.php>

![](https://raw.githubusercontent.com/iBaiYang/PictureWareroom/master/20200417/20200417132757.jpeg)

![](https://raw.githubusercontent.com/iBaiYang/PictureWareroom/master/20200417/20200417132758.jpeg)

![](https://raw.githubusercontent.com/iBaiYang/PictureWareroom/master/20200417/20200417132759.jpeg)

![](https://raw.githubusercontent.com/iBaiYang/PictureWareroom/master/20200417/20200417132760.jpeg)

![](https://raw.githubusercontent.com/iBaiYang/PictureWareroom/master/20200417/20200417132761.jpeg)

![](https://raw.githubusercontent.com/iBaiYang/PictureWareroom/master/20200417/20200417132762.jpeg)




<br/><br/><br/><br/><br/>
### 参考资料 

<http://www.yiichina.com/doc/guide/2.0/caching-overview>

<http://www.weixistyle.com/yii2.php>

