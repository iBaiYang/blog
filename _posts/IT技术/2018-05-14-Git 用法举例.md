---
layout: post
categories: IT技术
title: Git 用法举例
meta: 一般PhpStrom集合了Git，用的惯了，git命令行语法反而生疏了，所以应该记录一下，以备学习。
---
* content
{:toc}

### 正文

一般的开发流程是：从master拉取dev测试分支、pre预发布分支，再从master新拉版本分支ver1.0，从ver1.0拉取自己的开发分支dashi_0514，然后在自己的分支dashi_0514开发，提交到自己的远程分支dashi_0514，拉取远程项目分支ver1.0，提交合并到自己的远程分支dashi_0514，再把自己的修改提交到远程版本分支ver1.0，切换到dev分支，拉取dev变动，再拉取ver1.0变动，提交到远程dev分支。如此循环。直到测试无问题，再切到pre预发布分支，拉取远程ver1.0分支，然后推送到远程pre分支，测试预发布，持续修订到无问题。该版本开发结束，master拉取合并ver1.0分支，并推送到远程master分支，删除自己的开发分支dashi_0514，删除版本分支ver1.0（也可以保留封版），dev、pre保留继续作后续版本开发的测试、预发布分支。结束。准备下个版本ver2.0的开发。

git clone 分支地址 （自己可命名本地项目名）    

如：
> git clone https://github.com/lang/test.git lianxi

查看所有分支：
> git branch -a

创建dev新分支：
> git branch dev 

切换到dev分支：
> git checkout dev 

获取这样创建新分支并切换过去：
> (= git checkout -b dev) 

推送本地dev分支更新到远程dev分
> git push origin dev:dev 

也可以不用指定远程分支名，git会自动补齐
> （= git push origin dev） 


> git checkout master 
>
> git checkout -b ver1.0 
>
> git push origin ver1.0 

> git checkout -b dashi_0514 
>
> git push origin dashi_0514 


git remote show origin查看远程分支情况

![](https://raw.githubusercontent.com/iBaiYang/PictureWareroom/master/20190902/20190902113636.jpeg)

自己本地分支开发并提交到自己的开发远程分支

> git add . 
>
> git commit -m "修改" 
>
> git push -u origin dashi_0514 
>
> （= git push origin dashi_0514，第一次用-u自动绑定，以后 只要git push就可以） 

也可以用git branch -u dashi_0514:dashi 把本地dashi_0514分支绑定到远程dashi分支，以后就可以直接使用git pull和git push了
> git branch -u dashi_0514:dashi

从远程版本分支ver1.0拉取最新代码到自己本地开发分支dashi_0514
> git pull origin ver1.0:dashi_0514

版本分支的变动推送到自己远程分支
> git push origin dashi_0514

自己本地分支的变动推送到版本远程分支
> git push origin dashi_0514:ver1.0

（ 最好合并操作：）

> git checkout ver1.0
>
> git merge dashi_0514
>
> git push origin ver1.0


在本地dev分支拉取远程master分支变动：
> git pull origin master:dev

可能会有提示：
! [rejected]        master     -> dev  (non-fast-forward)
这种情况下可以用git merge合并远程分支到本地所在分支
> git merge origin/master



在本地ver1.0合并远程master分支变动：
> git checkout ver1.0
>
> git pull origin master:ver1.0

推送到远程ver1.0分支
> git push origin ver1.0


在本地dashi_0514合并远程ver1.0分支
> git checkout dashi_0514
>
> git merge origin/ver1.0

推送到远程dashi_0514分支
> git push origin dashi_0514


切换到本地dev分支
> git checkout dev

拉取dev远程分支最新代码
> git pull origin dev

拉取版本远程分支到本地dev分支
> git pull origin ver1.0:dev

（最好合并 git merge origin/ver1.0）

本地dev再推送到远程dev分支
> git push origin dev


如此循环反复开发，直至这个版本的开发任务结束，
合并到master
> git checkout master
>
> git merge origin/ver1.0
>
> git push origin master

git fetch 细细对比研究

然后删除相关分支
删除自己的本地分支
> git branch -d dashi_0514

删除自己的远程分支
```
    git push origin --delete dashi_0514
```


#### 注意事项
里面注意区分各分支的协同：

master只作为项目主干分支，目的是站点正式构建的基础。不接受其他各分支的推送，只拉取成熟版本分支的代码。
> git checkout master
>
> git pull origin ver1.0:master  (或者 git merge origin/ver1.0)
>
> git push origin master

dev作为项目测试分支，目的是测试环境构建的基础。因为可能有多个版本在多个小组手中同时开发，所以本地dev分支只拉取各版本分支变动（不拉取master分支），然后推送到远程dev分支。
> git checkout dev
> 
> git pull origin dev:dev
>
> git merge origin/ver1.0
>
> git push origin dev


ver1.0只作为众多版本中的一个开发分支，目的是版本小组协同开发的基础。只接受版本开发小组成员的推送（不拉取master代码，而是交给一个负责人去合并master。如果这里ver1.0拉取master的教训就是ver1.0只作为版本分支开发地位的丢失和复杂化）。
> git checkout ver1.0
> 
> git pull origin ver1.0



dashi_0514是自己在一个版本下的开发分支，只拉取特定版本分支，和向该版本分支推送自己的修改，还有就是自己的修改；另外，拉取master最新代码，这样自己就有责任维护ver1.0分支。
> git checkouk dashi_0514
>
> git merge origin/master   （合并master变化）
>
> git push
>
> git add .    （添加自己的修改）
>
> git commit -m "具体修改"
>
> git push
>
> git merge origin/ver1.0
>
> git push
>
> git push origin dashi_0514:ver1.0



附一个gitlab的例子：
```

Command line instructions
Git global setup

git config --global user.name "白杨"
git config --global user.email "baiyang@google.com"

Create a new repository

git clone http://baiyang@git.com/php/tmk.git
cd tmk
touch README.md
git add README.md
git commit -m "add README"
git push -u origin master

Existing folder

cd existing_folder
git init
git remote add origin http://baiyang@git.com/php/tmk.git
git add .
git commit -m "Initial commit"
git push -u origin master

Existing Git repository

cd existing_repo
git remote add origin http://baiyang@git.com/php/tmk.git
git push -u origin --all
git push -u origin --tags
```

还有如果你在github创建一个项目，可以看到如下提示：

```html
Quick setup — if you’ve done this kind of thing before
           https://github.com/iBaiYang/PictureWareroom.git
Get started by creating a new file or uploading an existing file. We recommend every repository include a README, LICENSE, and .gitignore. 

…or create a new repository on the command line
echo "# PictureWareroom" >> README.md
git init
git add README.md
git commit -m "first commit"
git remote add origin https://github.com/iBaiYang/PictureWareroom.git
git push -u origin master

…or push an existing repository from the command line
git remote add origin https://github.com/iBaiYang/PictureWareroom.git
git push -u origin master

…or import code from another repository
You can initialize this repository with code from a Subversion, Mercurial, or TFS project.
```

![](https://raw.githubusercontent.com/iBaiYang/PictureWareroom/master/20181123/20181123110020.jpg)

#### Git建议开发流程

![](https://raw.githubusercontent.com/iBaiYang/PictureWareroom/master/20190909/20190909134429.jpg)

![](https://raw.githubusercontent.com/iBaiYang/PictureWareroom/master/20190909/20190909134512.jpg)

文件的状态变化周期，未跟踪、未修改、已修改、暂存区：

![](https://raw.githubusercontent.com/iBaiYang/PictureWareroom/master/20190909/20190909134815.jpg)

版本负责人     新建版本分支
> git checkout master
>
> git pull origin master
>
> git checkout -b ver3.10.0
>
> git push origin ver3.10.0

开发工程师       新建开发分支
> git checkout ver3.10.0
>
> git checkout -b dragon190828
>
> git push origin dragon190828

开发工程师        开发细节
> git checkout dragon190828
>
> git add .
>
> git commit -m 'add menu to project'
>
> git push origin dragon190828

> git pull origin ver3.10.0
>
> git push origin dragon190828
>
> git checkout dev
>
> git pull origin dev
>
> git pull origin dragon190828
>
> git push origin dev

> git checkout dragon190828
>
> git pull origin ver3.10.0
>
> git push origin dragon190828
>
> git push origin dragon190828:ver3.10.0

版本负责人         新建上线分支
> git checkout master
>
> git pull origin master
>
> git checkout -b upline190920055
>
> git pull origin ver3.10.0
>
> git push origin upline190220055

项目负责人         版本上线
> git checkout master
>
> git pull origin master
>
> git pull origin upline190920055
>
> git pull origin upline190920132
>
> git push origin master

开发工程师         删除开发分支
> git branch -d dragon190828
>
> git push origin --delete dragon190828

版本负责人         删除上线分支
> git branch -d upline190920055
>
> git push origin --delete upline190920055


![](https://raw.githubusercontent.com/iBaiYang/PictureWareroom/master/20190909/20190909134616.jpg)

![](https://raw.githubusercontent.com/iBaiYang/PictureWareroom/master/20190909/20190909134714.jpg)

<br/><br/><br/><br/><br/>
### 参考资料

<https://git-scm.com/book/zh/v2>

git 函参 官方文档 <https://git-scm.com/docs/>

<https://www.liaoxuefeng.com/wiki/0013739516305929606dd18361248578c67b8067c8c017b000>

<https://www.yiibai.com/git/git_basic_concepts.html>

[git各种情况的版本回退](https://blog.csdn.net/sinat_29774479/article/details/78599702)

<https://www.jianshu.com/p/c12203116c48>

<https://mp.weixin.qq.com/s/2mDnInFnfZPIk7bT-NZPmA>

<https://mp.weixin.qq.com/s/Vm3yLzm2T67jOY6NoHlLWA>

<http://www.runoob.com/w3cnote/git-guide.html>

[Git查看、删除、重命名远程分支和tag](https://blog.zengrong.net/post/1746.html)

<https://www.yiibai.com/git/git_push.html>

<http://jekyllthemes.org/>

<https://blog.csdn.net/a19881029/article/details/42245955>

<https://blog.csdn.net/bin622/article/details/69948525>

<https://marklodato.github.io/visual-git-guide/index-zh-cn.html>

<https://blog.csdn.net/qq_15037231/article/details/77937402>

<https://blog.csdn.net/litianze99/article/details/52452521>

<https://zhuanlan.zhihu.com/p/28321740>

<http://jekyllcn.com/>

<http://wowubuntu.com/markdown/basic.html>

<http://wowubuntu.com/markdown/#autoescape>

<https://daringfireball.net/projects/markdown/dingus>

<https://www.zhihu.com/question/30018945?sort=created>

<https://pages.github.com/>

<https://www.jianshu.com/p/6cabb41495c8>

<https://www.jianshu.com/p/3f355c7872d5>

<http://www.ruanyifeng.com/blog/2012/08/blogging_with_jekyll.html>

<http://lixizhi.github.io/>

<https://html5up.net/>